var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var a,t=1,r=arguments.length;t<r;t++)for(var o in a=arguments[t])Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o]);return e},__assign.apply(this,arguments)};define(["require","exports","log","util.roberta","message","progList.model","userGroup.model","program.model","configuration.controller","program.controller","guiState.controller","jquery","blockly","table","bootstrap-table"],(function(e,a,t,r,o,s,l,n,i,p,c,d,g,b){var m,h,u,f,y,T;function L(){f=d("#programNameTable");var e={locale:c.getLanguage(),theadClasses:"table-dark",pageList:"[ 10, 25, All ]",toolbar:"#progListToolbar",showRefresh:"true",showPaginationSwitch:"true",columns:[{title:"<span lkey='Blockly.Msg.DATATABLE_PROGRAM_NAME'>"+(g.Msg.DATATABLE_PROGRAM_NAME||"Name des Programms")+"</span>",sortable:!0},{title:"<span lkey='Blockly.Msg.DATATABLE_CREATED_BY'>"+(g.Msg.DATATABLE_CREATED_BY||"Erzeugt von")+"</span>",sortable:!0},{events:k,title:"<span class='typcn typcn-flow-merge'></span>",sortable:!0,sorter:S,formatter:_,align:"left",valign:"middle"},{visible:!1},{title:"<span lkey='Blockly.Msg.DATATABLE_CREATED_ON'>"+(g.Msg.DATATABLE_CREATED_ON||"Erzeugt am")+"</span>",sortable:!0,formatter:r.formatDate},{title:"<span lkey='Blockly.Msg.DATATABLE_ACTUALIZATION'>"+(g.Msg.DATATABLE_ACTUALIZATION||"Letzte Aktualisierung")+"</span>",sortable:!0,formatter:r.formatDate},{title:'<input name="btSelectAll" type="checkbox">',formatter:function(e,a,t){return c.isUserMemberOfUserGroup()&&a[1]===c.getUserUserGroupOwner()?'<input type="checkbox" name="btSelectItem" data-index="'+t+'" disabled>':'<input type="checkbox" name="btSelectItem" data-index="'+t+'">'},valign:"middle",halign:"center",align:"center"},{events:A,title:R,align:"left",valign:"top",formatter:v,width:"117px"}]},a=__assign(__assign({},b.CommonTable.options),e);f.bootstrapTable(a),f.bootstrapTable("togglePagination")}function P(){h===m.Programs?function(){d("#programNameTable").bootstrapTable("showLoading"),f.bootstrapTable("showColumn",[2,6]),f.bootstrapTable("refreshOptions",{sortName:4,sortOrder:"desc",search:!0,filterControl:!0});var e=d("<select class='form-select filter' id='progListScopeSelect'><option data-translation-targets='html' value='userProgram'>"+g.Msg.MENU_LIST_PROG+"</option><optGroup data-translation-targets='label' id='progListUserGroupScope' label="+g.Msg.DATATABLE_USERGROUPS+"></optGroup></select>");d("#progList .search").prepend(e),c.isUserMemberOfUserGroup()||l.loadUserGroupList((function(e){"ok"==e.rc&&e.userGroups.length>0&&e.userGroups.forEach((function(e){d("#progListUserGroupScope").append('<option value="'+e.name+'">'+e.name+"</option>")}))}));s.loadProgList(E)}():(d("#programNameTable").bootstrapTable("showLoading"),f.bootstrapTable("hideColumn",[2,6]),f.bootstrapTable("refreshOptions",{sortName:0,sortOrder:"asc",search:!1,filterControl:!1}),s.loadExampleList(O)),u=d("#progList"),y=d("#progListUserGroupScope"),T=y.closest("select"),u.find('button[name="refresh"]').onWrap("click",(function(){switch(h){case m.Programs:T.trigger("change");break;case m.Examples:default:d("#programNameTable").bootstrapTable("showLoading"),s.loadExampleList(O)}return!1}),"refresh prog list"),T.change((function(){if(h!=m.Examples){var e=T.val();d("#programNameTable").bootstrapTable("showLoading"),"userProgram"===e?s.loadProgList(E):s.loadProgListFromUserGroupMembers(e,E)}})),f.onWrap("click-row.bs.table",(function(e,a){w(a)}),"Load program from listing clicked"),f.onWrap("check-all.bs.table",(function(){d(".deleteSomeProgHeader").removeClass("disabled"),f.find("#shareSome").removeClass("disabled"),f.find(".delete, .share, .gallery, .load").addClass("disabled")}),"check all programs"),f.onWrap("check.bs.table",(function(){d("#deleteSomeProg").removeClass("disabled"),f.find("#shareSome").removeClass("disabled"),f.find(".delete, .share, .gallery, .load").addClass("disabled")}),"check one program"),f.onWrap("uncheck-all.bs.table",(function(){d(".deleteSomeProgHeader").addClass("disabled"),f.find("#shareSome").addClass("disabled"),f.find(".delete, .share, .gallery, .load").filter(':not([data-status="disabled"])').removeClass("disabled")}),"uncheck all programs"),f.onWrap("uncheck.bs.table",(function(){var e=f.bootstrapTable("getSelections");e&&0!==e.length||(f.find(".deleteSomeProg").addClass("disabled"),f.find("#shareSome").addClass("disabled"),f.find(".delete, .share, .gallery, .load").filter(':not([data-status="disabled"])').removeClass("disabled"))}),"uncheck one program"),f.on("shown.bs.collapse hidden.bs.collapse",(function(){f.bootstrapTable("resetWidth")})),d(".deleteSomeProgHeader").onWrap("click",(function(){for(var e=f.bootstrapTable("getSelections",{}),a="<br>",t=0;t<e.length;t++)a+=e[t][0],a+="<br>";d("#confirmDeleteProgramName").html(a);var r=d("#confirmDeleteProgram");return r.oneWrap("hide.bs.modal",(function(){d("#programNameTable").bootstrapTable("showLoading"),s.loadProgList(E)})),r.data("programs",e),r.modal("show"),!1}))}function E(e){r.response(e),"ok"===e.rc?(f.bootstrapTable("load",e.programNames),d("#progList .search").show()):"loadPN"===e.cmd&&d("#backProgList").clickWrap(),f.bootstrapTable("hideLoading"),d(".deleteSomeProgHeader").attr("data-bs-original-title",g.Msg.PROGLIST_DELETE_ALL_TOOLTIP||"Click here to delete all selected programs."),f.find(".delete").attr("data-bs-original-title",g.Msg.PROGLIST_DELETE_TOOLTIP||"Click here to delete your program."),f.find(".share").attr("data-bs-original-title",g.Msg.PROGLIST_SHARE_TOOLTIP||"Click here to share your program with a friend."),f.find(".gallery").attr("data-bs-original-title",g.Msg.PROGLIST_SHARE_WITH_GALLERY_TOOLTIP||"Click here to upload your program to the gallery hence share it with all other users."),f.find(".load").attr("data-bs-original-title",g.Msg.PROGLIST_LOAD_TOOLTIP||"Click here to load your program in the programming environment."),f.find('[rel="tooltip"]').tooltip({trigger:"hover"})}function O(e){r.response(e),"ok"===e.rc?d("#programNameTable").bootstrapTable("load",e.programNames):"loadPN"===e.cmd&&d("#backProgList").clickWrap(),f.bootstrapTable("hideLoading"),f.find(".load").attr("data-bs-original-title",g.Msg.PROGLIST_LOAD_TOOLTIP||"Click here to load your program in the programming environment."),f.find('[rel="tooltip"]').tooltip({trigger:"hover"})}Object.defineProperty(a,"__esModule",{value:!0}),a.switchLanguage=a.init=void 0,function(e){e.Examples="Examples",e.Programs="Programs"}(m||(m={})),a.init=function(){L(),function(){var e=d("#tabProgList");function a(){f.bootstrapTable("resetView",{height:r.calcDataTableHeight()})}e.onWrap("show.bs.tab",(function(){c.setView("tabProgList"),h=m[e.data("type")],P()})),d("#backProgList").onWrap("click",(function(){return d("#tabProgram").tabWrapShow(),!1}),"back to program view"),f.onWrap("toggle-pagination.bs.table",(function(){a()})),d(window).onWrap("resize",(function(){a()}))}()},a.switchLanguage=function(){d("#programNameTable").bootstrapTable("destroy"),L(),P()};var k={"click .showRelations":function(e,a,t,r){e.stopPropagation(),d(".relation"+r).collapse("toggle")}},A={"click .delete":function(e,a,t){e.stopPropagation();for(var r=[t],o="<br>",s=0;s<r.length;s++)o+=r[s][0],o+="<br>";d("#confirmDeleteProgramName").html(o);var l=d("#confirmDeleteProgram");return l.data("programs",r),l.oneWrap("hidden.bs.modal",(function(){})),l.modal("show"),!1},"click .share":function(e,a,t){return e.stopPropagation(),t[2].sharedFrom||d("#show-relations").trigger("updateAndShow",[t]),!1},"click .gallery":function(e,a,t){return e.stopPropagation(),t[2].sharedFrom||c.isUserMemberOfUserGroup()||d("#share-with-gallery").trigger("updateAndShow",[t]),!1},"click .load":function(e,a,t){e.stopPropagation(),w(t)}},_=function(e,a,t){if(d.isEmptyObject(e))return'<span class="typcn typcn-minus"></span>';if("READ"===e.sharedFrom)return'<span class="typcn typcn-eye"></span>';if("WRITE"===e.sharedFrom)return'<span class="typcn typcn-pencil"></span>';if("X_WRITE"===e.sharedFrom)return'<span class="typcn typcn-key"></span>';if(e.sharedWith&&1==e.sharedWith.length){var r="";return d.each(e.sharedWith,(function(e,a){r+="<span>","User"===a.type&&"Roberta"===a.label||("READ"===a.right?r+='<span class="typcn typcn-eye"></span>':"X_WRITE"===a.right?r+='<span class="typcn typcn-key"></span>':"WRITE"===a.right&&(r+='<span class="typcn typcn-pencil"></span>')),"User"===a.type?r+='&nbsp;<span class="typcn typcn-user"></span>':"UserGroup"===a.type&&(r+='&nbsp;<span class="typcn typcn-group"></span>'),r+="&nbsp;",r+='<span class="value">',r+=a.label,r+="</span>",r+="</span>"})),r}if(e.sharedWith&&Object.keys(e.sharedWith).length>1){var o=[];d.each(e.sharedWith,(function(e,a){var t="";"User"===a.type?t='&nbsp;<span class="typcn typcn-user"></span>':"UserGroup"===a.type&&(t='&nbsp;<span class="typcn typcn-group"></span>'),"User"===a.type&&"Roberta"===a.label||("READ"===a.right?o.push('<span class="typcn typcn-eye"></span>'+t+'&nbsp;<span class="value">'+a.label+"</span>"):"WRITE"===a.right&&o.push('<span class="typcn typcn-pencil"></span>'+t+'&nbsp;<span class="value">'+a.label+"</span>"))}));var s='<div style="white-space:nowrap;"><span style="float:left;">';s+=o[0],s+='</span><a class="collapsed showRelations" href="#" style=" float:right;" href="#" data-bs-toggle="collapse" data-bs-target=".relation'+t+'"></a></div>';for(var l=1;l<o.length;l++)s+='<div style="clear:both;" class="collapse relation'+t+'">',s+=o[l],s+="</div>";return s}},v=function(e,a){var t="";return h===m.Programs&&(c.isUserMemberOfUserGroup()&&c.getUserUserGroupOwner()===a[1]?t+='<a href="#" class="delete disabled" data-status="disabled"><span class="typcn typcn-delete"></span></a>':t+='<a href="#" class="delete" rel="tooltip" lkey="Blockly.Msg.PROGLIST_DELETE_TOOLTIP" data-bs-original-title="" title=""><span class="typcn typcn-delete"></span></a>',a[2].sharedFrom?(t+='<a href="#" class="share disabled" data-status="disabled"><span class="typcn typcn-flow-merge"></span></a>',c.isUserMemberOfUserGroup()||(t+='<a href="#" class="gallery disabled" data-status="disabled"><span class="typcn typcn-th-large-outline"></span></a>')):(t+='<a href="#" class="share" rel="tooltip" lkey="Blockly.Msg.PROGLIST_SHARE_TOOLTIP" data-bs-original-title="" title=""><span class="typcn typcn-flow-merge"></span></a>',c.isUserMemberOfUserGroup()||(t+='<a href="#" class="gallery" rel="tooltip" lkey="Blockly.Msg.PROGLIST_SHARE_WITH_GALLERY_TOOLTIP" data-bs-original-title="" title=""><span class="typcn typcn-th-large-outline"></span></a>'))),t+='<a href="#" class="load" rel="tooltip" lkey="Blockly.Msg.PROGLIST_LOAD_TOOLTIP" data-bs-original-title="" title=""><span class="typcn typcn-document"></span></a>'},S=function(e,a){if(d.isEmptyObject(e)&&d.isEmptyObject(a))return 0;if(e.sharedFrom&&a.sharedFrom)return"WRITE"===e.sharedFrom&&"WRITE"===a.sharedFrom?0:"WRITE"===e.sharedFrom?1:-1;if(e.sharedWith&&a.sharedWith){var t={a:e.sharedWith[0].right,b:a.sharedWith[0].right};return t.a===t.b?0:"WRITE"===t.a?1:-1}return d.isEmptyObject(e)?-1:d.isEmptyObject(a)||e.sharedWith?1:-1},R='<a href="#" id="deleteSomeProg" class="deleteSomeProgHeader disabled" rel="tooltip" lkey="Blockly.Msg.PROGLIST_DELETE_ALL_TOOLTIP" data-bs-original-title="" data-container="body" title=""><span class="typcn typcn-delete"></span></a>';function w(e){t.info("loadFromList "+e[0]),n.loadProgramFromListing(e[0],e[1],e[3],(function(a){if("ok"===a.rc){a.programShared=!1;var t=e[1]===c.getUserAccountName()?null:e[1];t&&(a.programShared="READ"),e[2].sharedFrom&&(a.programShared=e[2].sharedFrom),a.name=e[0],c.setProgram(a,t),c.setProgramXML(a.progXML),void 0===a.configName?void 0===a.confXML?(c.setConfigurationNameDefault(),c.setConfigurationXML(c.getConfigurationConf())):(c.setConfigurationName(""),c.setConfigurationXML(a.confXML)):(c.setConfigurationName(a.configName),c.setConfigurationXML(a.confXML)),d("#tabProgram").oneWrap("shown.bs.tab",(function(){i.reloadConf(),p.reloadProgram()})),d("#tabProgram").tabWrapShow()}o.displayInformation(a,"",a.message,"","")}))}}));
//# sourceMappingURL=progList.controller.js.map
//# sourceMappingURL=progList.controller.js.map
