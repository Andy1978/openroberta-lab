var __awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function s(e){try{c(n.next(e))}catch(e){a(e)}}function i(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,i)}c((n=n.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var r,n,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(s=0)),s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};define(["require","exports","thymio","guiState.controller","guiState.model"],(function(e,t,r,n,o){Object.defineProperty(t,"__esModule",{value:!0}),t.stopProgram=t.uploadProgram=t.init=t.selectedNode=void 0;t.selectedNode=void 0;var a=void 0;function s(){a=Date.now(),o.robot.fWName=n.getRobotRealName(),o.robot.time=0,o.robot.battery="-",o.robot.name=t.selectedNode.name,o.robot.state="wait",n.updateMenuStatus(1)}function i(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:if(o.robot.time=a-Date.now(),!t.selectedNode||t.selectedNode.status!==r.NodeStatus.ready)return[3,8];n.label=1;case 1:return n.trys.push([1,6,,7]),[4,t.selectedNode.lock()];case 2:return n.sent(),[4,t.selectedNode.sendAsebaProgram(e)];case 3:return n.sent(),[4,t.selectedNode.runProgram()];case 4:return n.sent(),[4,t.selectedNode.unlock()];case 5:return n.sent(),[2,"done"];case 6:throw n.sent();case 7:return[3,9];case 8:throw new Error("Exception on upload program");case 9:return[2]}}))}))}t.init=function e(){var a=this;if(t.selectedNode)t.selectedNode.status==r.NodeStatus.ready&&s();else{var i=r.createClient("ws://localhost:8597");i.onClose=function(r){return __awaiter(a,void 0,void 0,(function(){return __generator(this,(function(r){return n.getConnection()===n.getConnectionTypeEnum().TDM&&(t.selectedNode=void 0,o.robot.fWName="",o.robot.time=-1,o.robot.battery="-",o.robot.name="",o.robot.state="error",n.updateMenuStatus(0),setTimeout(e,1e3)),[2]}))}))},i.onNodesChanged=function(o){return __awaiter(a,void 0,void 0,(function(){var a,i,c,u;return __generator(this,(function(l){switch(l.label){case 0:l.trys.push([0,8,,9]),a=0,i=o,l.label=1;case 1:if(!(a<i.length))return[3,7];if(c=i[a],t.selectedNode&&t.selectedNode.id!=c.id)return[3,6];if(t.selectedNode&&(t.selectedNode.status==r.NodeStatus.ready||c.status!=r.NodeStatus.available))return[3,5];l.label=2;case 2:return l.trys.push([2,4,,5]),[4,c.lock()];case 3:return l.sent(),t.selectedNode=c,s(),[3,5];case 4:return l.sent(),console.log("Unable To Log ".concat(c.id," (").concat(c.name,")")),[3,5];case 5:if(!t.selectedNode)return[3,6];t.selectedNode.status==r.NodeStatus.disconnected&&(t.selectedNode=void 0,n.updateMenuStatus(0),e()),l.label=6;case 6:return a++,[3,1];case 7:return[3,9];case 8:return u=l.sent(),console.log(u),[3,9];case 9:return[2]}}))}))}}},t.uploadProgram=i,t.stopProgram=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,i("motor.left.target = 0\nmotor.right.target = 0\ncall sound.system(-1)\ncall leds.circle(32,32,32,32,32,32,32,32)\ntimer.period[0] = 100\nonevent timer0\ncall leds.circle(0,0,0,0,0,0,0,0)\n")]}))}))}}));
//# sourceMappingURL=thymioSocket.controller.js.map
//# sourceMappingURL=thymioSocket.controller.js.map
